<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Foundation Library: Details on specific submodules and features provided by the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Foundation Library
   </div>
   <div id="projectbrief">Cross-platform application foundation library in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Overview</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Details on specific submodules and features provided by the library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="build_config"></a>
Build configuration</h1>
<p>Static build configuration is done in the <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> header by defining a set of preprocessor directives. All values can be set on compilation command line since the build declarations are checked for pre-existing definitions. It is, however, recommended to use the build header file to ensure the library and projects using the library have the same set of definitions.</p>
<p>Most important is the build type definition</p>
<p>For a full list and documentation of the build configuration preprocessor definitions, check the documentation for the <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> header</p>
<h1><a class="anchor" id="memory_management"></a>
Memory management</h1>
<p>Memory management is handled through a memory system implementation, which is basically three entry points for allocation, reallocation and deallocation. By default the foundation library provides a memory system built on the C library malloc/realloc/free family of functions, extended and wrapped to handle alignment requirements. When you initialize the foundation library you have to pass in a memory system implementation declaration through a <a class="el" href="structmemory__system__t.html" title="Memory management system declaration. ">memory_system_t</a> struct. To use the default malloc-based system, use <a class="el" href="memory_8h.html#a1d0f12f2cc1cfcf1f971d796350b3e63" title="Default malloc based memory system. ">memory_system_malloc</a>.</p>
<p>Memory allocations will belong to a memory context, which is usually a hash value of a module name (for example, <a class="el" href="hashstrings_8h.html#aa30311956ce26ee1299110e18ea38564" title="Hash of &quot;stream&quot;. ">HASH_STREAM</a>). This allows the memory tracker to place allocations in buckets to see how much memory each part/module of the software allocates at any given time. Memory context can be set explicitly with an argument to <a class="el" href="memory_8h.html#a533a4d5cb94f6bfe6c4289b2292e03dd" title="Allocate memory. ">memory_allocate</a> or implicitly through the thread local memory context stack controlled with <a class="el" href="memory_8h.html#acd065009f0b26996dad5f976bae8c241" title="Push context on memory context stack. ">memory_context_push</a> and <a class="el" href="memory_8h.html#ad20ff710fde100d7d59414d105456731" title="Pop context from memory context stack. ">memory_context_pop</a>. The thread local context is used if you pass 0 as context to <a class="el" href="memory_8h.html#a533a4d5cb94f6bfe6c4289b2292e03dd" title="Allocate memory. ">memory_allocate</a> and in <a class="el" href="memory_8h.html#a2118a53e0722e8bcbfb2ed85437540fc" title="Reallocate memory. ">memory_reallocate</a> when passed a null pointer.</p>
<p>Memory allocations can also give hint flags of the usage of the requested memory buffer. This allows the implementation to make optimizations and extra requirements during allocation. The memory hint flags are documented in <a class="el" href="types_8h.html#afff46e3dec0251d2d725ab4b7cacaa7e" title="Memory hints. ">memory_hint_t</a> with the most common flags being <a class="el" href="types_8h.html#afff46e3dec0251d2d725ab4b7cacaa7ea92ba252ebc74b4d96daffc0a0f852653">MEMORY_TEMPORARY</a> and <a class="el" href="types_8h.html#afff46e3dec0251d2d725ab4b7cacaa7eaf347db04860a476c84c9965ba99911fa">MEMORY_ZERO_INITIALIZED</a> for temporary (scope level) allocations and initialization to zero, respectively.</p>
<p>The memory management module also provides memory tracking if compiled with <a class="el" href="build_8h.html#a999773b6eb8f1b6f3cf0663bbe5b6af2" title="Memory tracker control. ">BUILD_ENABLE_MEMORY_TRACKER</a> set to 1, which tracks all allocations and deallocations and enable memory leak detection. A memory tracker is declared with the <a class="el" href="structmemory__tracker__t.html" title="Memory tracking system declaration. ">memory_tracker_t</a> struct, and the library provides a default local implementation in <a class="el" href="memory_8h.html#a280f5f81feaceee36745ddfc4d245194" title="Default local memory tracker. ">memory_tracker_local</a>. The maximum number of concurrent allocations the local memory tracker can keep track of is set with the <a class="el" href="build_8h.html#a843d3157e4c1e46b7cc20624bac49924" title="Maximum concurrect allocation tracked. ">BUILD_SIZE_MEMORY_TRACKER_MAX_ALLOCATIONS</a> preprocessor directive in <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> header. A networked memory tracker will be provided in a network library, and further entry points to query the tracker during runtime will be added in a later release. Right now the tracker only prints detected leaks on application termination.</p>
<p>Finally there is a memory overwrite/underwrite guard functionality built in and enabled with the <a class="el" href="build_8h.html#a34aecd24ccd1a7e6241f7ce0c6cb5e8f" title="Memory guard control. ">BUILD_ENABLE_MEMORY_GUARD</a> <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> preprocessor directive. This will incur a slight memory overhead on each allocation, adding a dead zone before and after each allocated memory block for detecting invalid memory writes outside the allocated area. This functionality is built on top of the memory system implementation which does not need to provide a guard implementation internally.</p>
<h1><a class="anchor" id="threading"></a>
Threading</h1>
<h2><a class="anchor" id="threads"></a>
Threads</h2>
<p>The threading module provides functionality to create and manage new execution threads and handle thread synchronization with mutexes and semaphores. Threads are reference counted (see <a class="el" href="overview_page.html#object_lifetime">Object lifetime</a>) and lifetime controlled by <a class="el" href="thread_8h.html#aec1500740cfddde79e2a2338929fddd0" title="Create thread. ">thread_create</a>, <a class="el" href="thread_8h.html#ab80d8d7b90162b1fef24baa08a4593ba" title="Destroy thread. ">thread_destroy</a> and <a class="el" href="thread_8h.html#ace1c20370b1b0dfbc4d4468b2d3f6e8f" title="Reference thread. ">thread_ref</a>. A thread object represents a single execution thread for a specific function and cannot be reused for multiple execution threads of the same function. To have multiple execution threads of the same function, you must create multiple thread objects.</p>
<p>Thread execution is controlled with <a class="el" href="thread_8h.html#ad9e4d3b8b827566f250031d7daf0e9cc" title="Start thread. ">thread_start</a> and <a class="el" href="thread_8h.html#a1f3df23f5cac5aa25763ef3391718297" title="Terminate execution. ">thread_terminate</a>. Note that thread termination only sets the internal flag that the thread should terminate, the execution function must use <a class="el" href="thread_8h.html#a3b574a24eb71d81188a34a396b5787d4" title="Query if thread should terminate. ">thread_should_terminate</a> to check if termination is triggered. You can use <a class="el" href="thread_8h.html#a15108f4a13decb0f404eb23098363916" title="Query if started. ">thread_is_started</a> to query if a thread has been started, and <a class="el" href="thread_8h.html#a1a01dee046ffb83a153f143d4e6bedb2" title="Query if running. ">thread_is_running</a> to query if the thread is currently executing. A thread has a single result value of type void* which is the return value of the execution function. You can get the result value from <a class="el" href="thread_8h.html#a4eebaf677fbd703a89877ffe04e5ecc2" title="Get result. ">thread_result</a> once the thread has terminated.</p>
<p>You can set thread affinity to specific CPU core(s) with the <a class="el" href="thread_8h.html#a4a89520f75e85e507aec3f45b9218d23" title="Set affinity. ">thread_set_hardware</a> function taking a bit mask of allowed cores, and use <a class="el" href="thread_8h.html#a479b1e84041e8c5dc4d2e76520d67e50" title="Get hardware thread. ">thread_hardware</a> to query which CPU core a thread is currently running on. To query how many CPU cores that are available use <a class="el" href="system_8h.html#a180e991028599cb7f5d20c9aa5ee04b2" title="Get number of hardware execution threads. ">system_hardware_threads</a>.</p>
<p>The foundation library has the concept of a single main thread which is the application control thread. To set and query the main thread flag, use <a class="el" href="thread_8h.html#a04cbbd8ae151d34c189e82411312e61d" title="Mark as main thread. ">thread_set_main</a> and <a class="el" href="thread_8h.html#a06d7f41f6352ed1fb4939cf8a10ced1b" title="Query if main thread. ">thread_is_main</a>. To further help debugging and thread identification, use <a class="el" href="thread_8h.html#a98e78eda6129d12fb834b4a7d7cad1b5" title="Set name. ">thread_set_name</a> to set a human readable name for the thread which you will be able to see in the debugger.</p>
<p>Thread execution time slices can be given up to other execution threads with <a class="el" href="thread_8h.html#aaa9229e0f462f60bb9550919fa3d7699" title="Yield. ">thread_yield</a>. For time controlled suspension of thread execution use <a class="el" href="thread_8h.html#a2db1b3b38f90dc961bf34628ed457a28" title="Sleep. ">thread_sleep</a>.</p>
<p>If you want to use the JNI to call into the JVM in a thread on the Android platform you must attach the thread using <a class="el" href="thread_8h.html#a0107508383e3e6b2ea762a7fa5ed9348" title="Attach JVM. ">thread_attach_jvm</a>. Remember to call <a class="el" href="thread_8h.html#ae77a12dc9634bedcac83729501a97d09" title="Detach JVM. ">thread_detach_jvm</a> before terminating the thread to release the resources allocated by the attach call.</p>
<h2><a class="anchor" id="thread_synchonization"></a>
Synchronization</h2>
<p>The foundation library provides two mechanisms for thread synchronization, mutexes and semaphores. A mutex provides a lock for providing exclusive access to a resource or execution section as well as a signal/wait notifiction event, and a semaphore provides a thread safe access counter.</p>
<p>A mutex is allocated and destroyed with <a class="el" href="mutex_8h.html#a07966dda74e1aea62b19d4dd0dc339ab" title="Allocate mutex. ">mutex_allocate</a> and <a class="el" href="mutex_8h.html#a9a5610e3fcd43b99f2b00be586261395" title="Deallocate mutex. ">mutex_deallocate</a>. The mutex name is for debugging purposes only (also used in profiling events), limited to 32 characters. <a class="el" href="mutex_8h.html#a854e7d51da5d11f1a1301b2d0daf4642" title="Lock mutex blocking. ">mutex_lock</a> will lock the mutex to the calling thread and block until a lock can be obtained if another thread currently holds the lock. <a class="el" href="mutex_8h.html#a8d56c416448ec682366396e31a6b0fcb" title="Unlock mutex. ">mutex_unlock</a> will unlock the mutex if the lock is held by the calling thread. To lock without blocking, use <a class="el" href="mutex_8h.html#ab4793334e248160ebcb1b4a8bba93806" title="Try to lock mutex without blocking. ">mutex_try_lock</a>, which will return false if the lock could not be obtained in the given time span. Mutexes are reentrant, meaning a thread can lock the same mutex with <a class="el" href="mutex_8h.html#a854e7d51da5d11f1a1301b2d0daf4642" title="Lock mutex blocking. ">mutex_lock</a> multiple times without blocking, and the mutex is only unlocked when <a class="el" href="mutex_8h.html#a8d56c416448ec682366396e31a6b0fcb" title="Unlock mutex. ">mutex_unlock</a> has been called by the thread the same number of times.</p>
<p>Mutex signals can be used to provide a simple way of combining a thread wait/lock scheme. A thread uses <a class="el" href="mutex_8h.html#a530dfd47311f701ad3b8bfa261d1b356" title="Wait for signal blocking. ">mutex_wait</a> to wait for a signal state sent by another thread with <a class="el" href="mutex_8h.html#a6da3b66255457bb776b910ada1d68a7c" title="Signal mutex. ">mutex_signal</a>, and if the thread was woken by a signal the mutex lock will be obtained and the <a class="el" href="mutex_8h.html#a530dfd47311f701ad3b8bfa261d1b356" title="Wait for signal blocking. ">mutex_wait</a> function returns true. Remember to call <a class="el" href="mutex_8h.html#a8d56c416448ec682366396e31a6b0fcb" title="Unlock mutex. ">mutex_unlock</a> once lock is no longer needed.</p>
<p>Semaphores provide an interface to a counter which threads can use to have access to a resource limited to a specific number of concurrent uses (for example in a producer/consumer scheme). Mutexes can be considered a binary semaphore (maximum value of 1) with additional ownership tracking. You post to a semaphore to increase the counter (produce) and wait to decrease the counter (consume). If the current value is zero the wait will block until another thread has made a post to increase the value.</p>
<h2><a class="anchor" id="atomic_operations"></a>
Atomic operations</h2>
<p>Atomic operations are provides for 32-bit and 64-bit data types, along with an aliased interface for pointers which uses the appropriate 32/64-bit interface depending on architecture pointer size. There are also acquire/release memory fences for both signal and thread fencing.</p>
<h1><a class="anchor" id="debugging"></a>
Debugging, profiling, logging and error handling</h1>
<h2><a class="anchor" id="debugging_error_handling"></a>
Error handling</h2>
<p>Error handling is done with return values couple with thread local error state. Return values are either bool, integer or pointer values where false, negative values and null indicate an error condition respectively. The thread local error state is set with calls to either error log functions or error_report (see <a class="el" href="error_8h.html" title="Error context and reporting. ">error.h</a> file documentation). The error state of one thread does not affect the error state of any other thread. Reading the error state with a call to <a class="el" href="error_8h.html#af55923f35d538d8c78e31377d448f156" title="Get current error. ">error</a> will reset the state to no error.</p>
<p>As an extra debugging help there is also a thread local error context stack providing debug messages and debug data for each layer of the current call stack using the error context functionality. The context frames are pushed and popped from the stack with calls to <a class="el" href="error_8h.html#a5129a4ebf25c6cfe9533a94c1da2fcc7" title="Push error context. ">error_context_push</a> and <a class="el" href="error_8h.html#a9b0de0eccc207abcd7319f0a0b9607c7" title="Pop error context. ">error_context_pop</a>, read with <a class="el" href="error_8h.html#a315fb3058c86cd17004c65a25c4699b0" title="Get error context. ">error_context</a> and converted to descriptive string format with <a class="el" href="error_8h.html#a0aeb868783914a890a1179b844c78d1c" title="Generate error context stack trace. ">error_context_buffer</a>. If you need to have a local variable which only exists for error contexts, use <a class="el" href="error_8h.html#a23f5661f637d7c38fa78a7eb6a50d867" title="Make local declaration. ">error_context_declare_local</a>. Error context functionality is controlled by the <a class="el" href="build_8h.html#ab545de5602e072b2757c45c91fb73b27" title="Error context control. ">BUILD_ENABLE_ERROR_CONTEXT</a> build control in <a class="el" href="build_8h.html" title="Build setup. ">build.h</a>, and disabling it will reduce all error context calls and local variable declarations to void.</p>
<h2><a class="anchor" id="debugging_logging"></a>
Logging</h2>
<p>Logging output is provided in <a class="el" href="log_8h.html" title="Log output, filtering, context handling and callbacks. ">log.h</a> through five different severity levels (debug, info, warning, error, panic, in increasing order of severity). Log messages are associated with a context (usually a hash of the corresponding module name string), and can be suppressed based on severity level per context using <a class="el" href="log_8h.html#aa6a456cb6195828b150df0642425a3d4" title="Control log suppression. ">log_set_suppress</a>. If a context has no specific suppression level set, it will fall back on the default context (value 0) suppression.</p>
<p>Log messages are by default prefixed with additional debug data "[0:00:06.024] &lt;513:0&gt;" where the fields are time since startup, thread id and processor core, respectively. You can disable this prefix with <a class="el" href="log_8h.html#a63694c835e22615c99270d8fc63ce1d3" title="Control output of prefix information. ">log_enable_prefix</a>. Log messages are by default printed on stdout, which can be controlled with <a class="el" href="log_8h.html#a8595c2da77e4f401cc04b2a5aaeb233a" title="Control log output to stdout. ">log_enable_stdout</a>. On Windows log messages are always output to the debugger with OutputDebugString.</p>
<p>To pipe log messages to other outputs use the log callback by implementing your own callback function and registering it using <a class="el" href="log_8h.html#a87e18de9e432618b6b1a988613cc698d" title="Set log callback. ">log_set_callback</a>. All final formatted log messages (after suppression and context filtering) will be passed to the callback.</p>
<p>Finally, the <a class="el" href="build_8h.html#aeea2d85992d19ada2b335651b0747028" title="Log control. ">BUILD_ENABLE_LOG</a> controls if log functions are enabled. If the build control is disabled, all log function calls will be reduced to void. The debug functions <a class="el" href="log_8h.html#afa146415b1b9a537cc1b5f4e1c2a510e" title="Log unformatted debug message. ">log_debug</a> and <a class="el" href="log_8h.html#a4225e8fd7a6b3921ad8b1653f0fe5482" title="Log formatted debug message. ">log_debugf</a> have a separate build control <a class="el" href="build_8h.html#a452ba56a386f9cba47c64ca56d35c1d2" title="Debug log control. ">BUILD_ENABLE_DEBUG_LOG</a>.</p>
<h2><a class="anchor" id="debugging_crash_dumps"></a>
Crash dumps</h2>
<p>The foundation library provides structured exception handling based guards on Windows and signal based guards on posix compatible platforms. The guard acts as a proxy function call which will call the guarded function and catch any exceptional state. If an exception is caught, the state is written to a crash dump file and a callback is called with the dump information. The guard function itself returns with a specific value indicating a dump was generated. For more information on the guard and callback check the <a class="el" href="crash_8h.html" title="Crash guards and dump utilities. ">crash.h</a> documentation.</p>
<h2><a class="anchor" id="debugging_profiling"></a>
Profiling</h2>
<p>The profiling module provides an efficient function-level profiling system. It is not intended for fine grained instruction level optimization, but rather profiling the entire application on a function level scope. The module does not allocate any memory and is reentrant (thread safe). The basic use is to begin/end scope blocks around functions entry/exit with calls to <a class="el" href="profile_8h.html#af998e148e6aa58b500dff4b3b33819fb" title="Begin block. ">profile_begin_block</a> and <a class="el" href="profile_8h.html#a434960a356b892d37f2cbb8da9d21167" title="End block. ">profile_end_block</a>. All string identifiers should be valid until the profile module flushes the data to the output function, and the easiest way to guarantee this is to use static C strings as identifiers (for example, <code>profile_begin_block("my block");</code>). If a block runs for a long time you should also call <a class="el" href="profile_8h.html#a885f914b31508a30beab898a7bf189c5" title="Update block. ">profile_update_block</a> to update information about which CPU core the thread is running on.</p>
<p>Data is collected on a frame-by-frame basis, make sure to call <a class="el" href="profile_8h.html#a0c5f7fe5c6eb76e7d7cf299b4a625998" title="End frame. ">profile_end_frame</a> at the end of an application frame. All profile blocks must be closed by the time the frame is ended.</p>
<p>To enable the profile module you need to call <a class="el" href="profile_8h.html#a4f5f65088f86b8a3bc23698bc6a99282" title="Control profiling. ">profile_enable</a>. The module is initially disabled. On enble, the module starts a low-priority background thread which handles flushing the profile data to the output callback set by <a class="el" href="profile_8h.html#a9fd9a1e8429e3bb94e133e5a0faec8ce" title="Set output function. ">profile_set_output</a>. If no output callback is set, the profile data is silently discarded. You can control the rate at which the output flush thread wakes with <a class="el" href="profile_8h.html#ae2f4a95a27b9d10be72ab89fabde253b" title="Control output rate. ">profile_set_output_wait</a> as number of milliseconds to sleep between each flush. The smaller memory buffer you intialize the profiling module with, the more ofter the output thread needs to wake and flush in order to avoid data being lost from being out of memory. Default wait sleep is 100 milliseconds.</p>
<p>There are also functions for adding notices about mutex locks, waits and signals, as well as generic log messages.</p>
<p>All profiling module functions are enabled/disabled with the <a class="el" href="build_8h.html#a14600f55ebbc1336abf5313bc228e107" title="Profile control. ">BUILD_ENABLE_PROFILE</a> build config directive in the <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> header. If you set <a class="el" href="build_8h.html#a14600f55ebbc1336abf5313bc228e107" title="Profile control. ">BUILD_ENABLE_PROFILE</a> to 0, all profiling function calls will evaluate to void and not generate any code.</p>
<p>In the future we will provide a UI tool to analyze profiling data dumps and a network output client/server for collecting and analyzing profiling data remotely.</p>
<h1><a class="anchor" id="streams_files"></a>
Streams and file access</h1>
<h2><a class="anchor" id="streams"></a>
Streams overview</h2>
<p>Streams provide a generalized streaming I/O to various resources such as files, memory buffers, network sockets and pipes. The functions abstract away any platform specific implementations, byte order handling, binary/ascii modes and provides a single interface for I/O to any stream types. The functions in <a class="el" href="stream_8h.html" title="Stream I/O. ">stream.h</a> can be used to read/write to any stream type, and the stream specific implementations is handled through a "virtual table" of function pointers provided by the specific type.</p>
<p>Generally the generalized <a class="el" href="stream_8h.html" title="Stream I/O. ">stream.h</a> module functions is the only interface needed, but when initializing stack based or allocating heap stream objects of specific types (like <a class="el" href="bufferstream_8h.html#a686214e33b2e151ae75c69d17c32ac64" title="Initialize stream for memory buffer. ">buffer_stream_initialize</a> and <a class="el" href="bufferstream_8h.html#a5bf30921023b181becaf05c608a3125c" title="Allocate stream for memory buffer. ">buffer_stream_allocate</a>) you need to use the type specific initialization/allocation function and then the generalized stream functions to do any I/O.</p>
<p>Stream functions are not reentrant. If you need to do thread safe stream I/O you need to wrap it with a mutex lock or similar construct. A special case is the ring buffer stream, where one thread can write and another thread read concurrently.</p>
<h2><a class="anchor" id="stream_paths"></a>
Paths and protocols</h2>
<p>Streams are identified by a full path including a type "protocol". The full path format is "\&lt;protocol&gt;:\&lt;path&gt;". For example, a file stream full path is "file://tmp/appname/somefile.ext". The <a class="el" href="stream_8h.html#a0b0f039b26b8634812c0adc167f99c79" title="Open stream. ">stream_open</a> function will correctly identify stream type from the protocol and initialize the correct data structure.</p>
<p>All paths use forward slashes "/" as separators. Absolute paths start with a root separator, "/absolute/path", and relative paths start without a separator, "relative/path". If the path is a full path including a protocol, the path is always considered to be absolute and should begin with a double forward slash, "//absolute/path". Thus together with the protocol specifier and the protocol separator, the full path becomes "protocol://absolute/path".</p>
<p>The <a class="el" href="path_8h.html" title="Path utilities. ">path.h</a> module provides utility functions to work with paths. All external paths of uncertain formats should be sanitized with <a class="el" href="path_8h.html#abab2144936e9fc8d6586b6220a2f335a" title="Clean up path. ">path_clean</a> to make it adhere to the path format used in the library. All other stream and path functions assume the path is well formed and on the format specified above.</p>
<h2><a class="anchor" id="stream_byte_ordering"></a>
Byte ordering</h2>
<p>Streams with multi-byte data naturally have a byte order associated with the data. Since streams can wrap a network socket, the stream module provides automatic and transparent byte order handling based on the byte order of the stream and the byte order of the executing hardware. By default, streams local to the executing process such as memory buffer streams and pipes have the same byte order as the executing hardware. Other streams default to the byte order specified in the build configuration directive <a class="el" href="build_8h.html#a8d7f192e6ad36f4431ab00c0d3e5a136" title="Default stream byte order. ">BUILD_DEFAULT_STREAM_BYTEORDER</a> (which defaults to little endian). You should set the byte order of a stream with <a class="el" href="stream_8h.html#a62542c760964f37882aa6a900b78fb02" title="Set byte order. ">stream_set_byteorder</a> if needed.</p>
<p>Once you have set the correct byte order on a stream all multi-byte read/write operations with automatically convert and I/O the data in the appropriate format. No further byte swapping is needed in the application code.</p>
<h2><a class="anchor" id="stream_traits"></a>
Stream traits and modes</h2>
<p>Streams have a number of traits that determine what kind of features and guaranteed the stream type implementation provides. This allows the stream interface to abstract across UDP network streams and other non-reliable resources.</p>
<p>The stream traits are inorder, reliable, sequential, binary, and swapped. The traits can be queried with stream_is_&lt;trait&gt; family of functions. Only binary and byte order traits can be changed explicitly, all other traits are inherent to the stream type. Operations unsupported by the stream trait set will silently be ignored (like seeking backwards on a sequential stream). The traits meanings: </p><ul>
<li>
<b>in order:</b> The data written to the stream is guaranteed to be read back in the same order </li>
<li>
<b>reliable:</b> The data written to the stream is guaranteed to be readable </li>
<li>
<b>sequential:</b> The data can only be written to and read from the stream in sequence. No random access is available, and only forward seeking from the current position is supported. Stream size is generally unavailable for sequential streams. </li>
<li>
<b>binary:</b> Data is written to and read from the stream in binary format. If the binary trait is not set, data will be converted to/from ASCII strings before write or after read operations. </li>
<li>
<b>swap:</b> Multi-byte data byte order will be swapped before write or after read operations (only for binary streams). </li>
</ul>
<p>Streams are opened with a specific open mode, see <a class="el" href="types_8h.html#a1645a927d1cb1aa73e3bb225c5f9dc8d" title="Stream open modes. ">stream_mode_t</a>. Some streams will enforce specific modes (like read-only or write-only). Operations unsupported by the current mode will be silently ignored (like reading from a write-only mode stream). If the requested mode is unavailable for a given stream implementation or trait set it will be silently ignored.</p>
<h2><a class="anchor" id="stream_special"></a>
Special streams</h2>
<p>The standard library stdout, stderr and stdin files are wrapped in special streams available through the <a class="el" href="stream_8h.html#a72c5751cde6cfdd3a1c21bc0df15cf65" title="Open stdout stream. ">stream_open_stdout</a>, <a class="el" href="stream_8h.html#a97f7777d8a24c0bed12fb3f5f7b5314e" title="Open stderr stream. ">stream_open_stderr</a> and <a class="el" href="stream_8h.html#ad7b1dfe8c49e55aae0920f2a3b021127" title="Open stdin stream. ">stream_open_stdin</a> functions. Stdout and stderr are write-only, while stdin is read-only.</p>
<h1><a class="anchor" id="data_structures"></a>
Data structures</h1>
<p>The library provides a number of basic container data types.</p>
<h2><a class="anchor" id="data_arrays"></a>
Arrays</h2>
<p>The <a class="el" href="array_8h.html" title="Simple resizable array of integral/POD types. ">array.h</a> module is a simple resizable array implemented as a set of macros operating directly on the argument pointer. Memory allocation is done in chunks reserving additional memory when the current capacity is used up. Arrays are never implicitly resized to a smaller capacity in order to avoid extra allocations and memory copy operations. By default the array does not preserve order but rather use swap-with-last to erase elements, and operations are not ranged checked. The <code>*_ordered</code> functions provide order preserving operations and <code>*_safe</code> functions provide range checking. Arrays are not thread safe, you need to use a mutex or similar construct to wrap operations for thread safety.</p>
<h2><a class="anchor" id="data_hashmap"></a>
Hash map</h2>
<p>The <a class="el" href="hashmap_8h.html" title="Simple container mapping hash values to pointers. ">hashmap.h</a> module is a resizable hash map providing mapping between hash value keys and pointer data. The hash map will have a fixed number of buckets set at initialization time, but each bucket will grow to accomodate storage need by utilizing the array module. Hash maps are not thread safe, you need to use a mutex or similar construct to wrap operations for thread safety.</p>
<h2><a class="anchor" id="data_hashtable"></a>
Hash table</h2>
<p>The <a class="el" href="hashtable_8h.html" title="Lock-free key-value mapping container. ">hashtable.h</a> module is a fixed size hash table providing a thread safe atomic hash table mapping hash value keys to 32 or 64 bit value data. All operations are thread safe, which also limits the functionality to storing a 32 or 64 bit data element per hash key. Also, keys can not be fully erased once stored, only reset to hold value zero as an indicator of the key being erased. Therefor the size of the hash table must be initialized to the maximum number of unique keys to be stored over the lifetime of the hash table.</p>
<h1><a class="anchor" id="strings"></a>
String handling and unicode support</h1>
<p>The <a class="el" href="string_8h.html" title="String utility functions. ">string.h</a> module provides string utility functions focusing on features, utf-8 support and ease of use rather than performance and minimal footprint. If you are building an application that relies heavily on string processing, you would be better off looking at additional libraries.</p>
<h2><a class="anchor" id="string_utf8"></a>
UTF-8 and wide character strings</h2>
<p>All strings are considered to be on UTF-8 format. However, most length, offset and other index type variables and arguments are considered to be representing bytes, not compound UTF glyphs consisting of multiple UTF-8 byte sequences. This means functions like <a class="el" href="string_8h.html#a75f3c3d25a8c37502a1a18ac8d3d9963" title="Get string length. ">string_length</a> returns the length of the string buffer in bytes (memory footprint). To get the number of actual UTF glyphs in a string and the glyphs themselves, use <a class="el" href="string_8h.html#a4e89b9901a537a65b3580c0507aef5a4" title="Get number of glyphs. ">string_glyphs</a> and <a class="el" href="string_8h.html#a880a9c09edac8648bb7b97c4b1277046" title="Get unicode glyph. ">string_glyph</a>.</p>
<p>There are utility functions to convert to and from wide character strings, UTF-16 strings and UTF-32 strings. The API is designed around performing all operations in UTF-8 format and only using wide string formats in external APIs.</p>
<h2><a class="anchor" id="string_handling"></a>
String functions</h2>
<p>The module provides functions to allocate, initialize, format and deallocate strings both allocating new memory buffers as well as working with existing pre-allocated buffers. Unless otherwise noted in the API documentation, all functions allow null pointers to be passed as arguments (treated as empty strings).</p>
<p>In general, all arguments of type <code>char*</code> are expected to be strings allocated by the string module or <a class="el" href="memory_8h.html#a533a4d5cb94f6bfe6c4289b2292e03dd" title="Allocate memory. ">memory_allocate</a>. These arguments can be modified and reallocated by the function, and generally a new string pointer is returned by the function. Arguments of type <code>const char*</code> can be any string, including static compile time strings and stack based data. These arguments will never be modified or reallocated. The function will allocate a new string if the return type is a <code>char*</code>. For more details, check the API documentation for each function.</p>
<p>The <a class="el" href="string_8h.html#a6a3eaddf2a94280f7b34ce77404ba254" title="Find character. ">string_find</a> find family of functions takes offset arguments which are byte offsets into the given string argument. Invalid offsets are denoted by the STRING_NPOS constant (-1). If reverse find functions (last of and rfind), STRING_NPOS will mean searching from the end of the string. Apart from the special STRING_NPOS offset, all other offset arguments are expected to be valid in [0..string_length] interval.</p>
<h2><a class="anchor" id="string_regex"></a>
Regular expressions</h2>
<p>Apart from the simple wildcard <a class="el" href="string_8h.html#aa117b4220ce037b26ed4bcd59c24c83c" title="Query if pattern match. ">string_match_pattern</a> function, the <a class="el" href="regex_8h.html" title="Small regular expression implementation. ">regex.h</a> provides a limited regular expression module with a subset of perl regex features. The regex module supports the following features: </p><pre>^        Match beginning of string
    $        Match end of string
    .        Match one character
    ()       Group and capture substring
    []       Match any character from the grouped set
    [^]      Match any character but ones from the grouped set
    \s       Match whitespace
    \S       Match non-whitespace
    \d       Match decimal digits
    \D       Match non-digits
    \n       Match newline
    \r       Match carriage return
    +        Match one or more times (longest possible match)
    +?       Match one or more times (shortest possible match)
             Match zero or more times (longest possible match)
     ?       Match zero or more times (shortest possible match)
    ?        Match zero or once
    \XX      Match byte with hex value 0xXX
    \meta    Match one of the meta characters ^$()[].*+?|\
</pre><p> Substring capturing is optional, and if performed it will capture start pointers and lengths of matched substrings and will not allocate any additional memory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 8 2014 13:26:45 for Foundation Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
