<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Foundation Library: /Users/mjansson/projects/foundation_lib/foundation/memory.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Foundation Library
   </div>
   <div id="projectbrief">Cross-platform application foundation library in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c02a266b809652a081fe9248161d9c6.html">foundation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">memory.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Memory management.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="platform_8h_source.html">foundation/platform.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="types_8h_source.html">foundation/types.h</a>&gt;</code><br />
</div>
<p><a href="memory_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad20ff710fde100d7d59414d105456731"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#ad20ff710fde100d7d59414d105456731">memory_context_pop</a>()</td></tr>
<tr class="memdesc:ad20ff710fde100d7d59414d105456731"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pop context from memory context stack.  <a href="#ad20ff710fde100d7d59414d105456731">More...</a><br /></td></tr>
<tr class="separator:ad20ff710fde100d7d59414d105456731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca33749545ba97f1d9193fbe35d6bf80"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#aca33749545ba97f1d9193fbe35d6bf80">memory_context</a>()</td></tr>
<tr class="memdesc:aca33749545ba97f1d9193fbe35d6bf80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current memory context.  <a href="#aca33749545ba97f1d9193fbe35d6bf80">More...</a><br /></td></tr>
<tr class="separator:aca33749545ba97f1d9193fbe35d6bf80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af">memory_context_thread_deallocate</a>()</td></tr>
<tr class="memdesc:a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup memory context stack.  <a href="#a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af">More...</a><br /></td></tr>
<tr class="separator:a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a533a4d5cb94f6bfe6c4289b2292e03dd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a533a4d5cb94f6bfe6c4289b2292e03dd">memory_allocate</a> (uint64_t context, uint64_t size, unsigned int align, int hint)</td></tr>
<tr class="memdesc:a533a4d5cb94f6bfe6c4289b2292e03dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory.  <a href="#a533a4d5cb94f6bfe6c4289b2292e03dd">More...</a><br /></td></tr>
<tr class="separator:a533a4d5cb94f6bfe6c4289b2292e03dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2118a53e0722e8bcbfb2ed85437540fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a2118a53e0722e8bcbfb2ed85437540fc">memory_reallocate</a> (void *p, uint64_t size, unsigned int align, uint64_t oldsize)</td></tr>
<tr class="memdesc:a2118a53e0722e8bcbfb2ed85437540fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reallocate memory.  <a href="#a2118a53e0722e8bcbfb2ed85437540fc">More...</a><br /></td></tr>
<tr class="separator:a2118a53e0722e8bcbfb2ed85437540fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62d8f5df74f1f7e2e5ce2788d76c0ef7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a62d8f5df74f1f7e2e5ce2788d76c0ef7">memory_deallocate</a> (void *p)</td></tr>
<tr class="memdesc:a62d8f5df74f1f7e2e5ce2788d76c0ef7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate memory.  <a href="#a62d8f5df74f1f7e2e5ce2788d76c0ef7">More...</a><br /></td></tr>
<tr class="separator:a62d8f5df74f1f7e2e5ce2788d76c0ef7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd065009f0b26996dad5f976bae8c241"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#acd065009f0b26996dad5f976bae8c241">memory_context_push</a> (uint64_t context)</td></tr>
<tr class="memdesc:acd065009f0b26996dad5f976bae8c241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push context on memory context stack.  <a href="#acd065009f0b26996dad5f976bae8c241">More...</a><br /></td></tr>
<tr class="separator:acd065009f0b26996dad5f976bae8c241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9610bb0fee6903e14e4e521b62565cac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a9610bb0fee6903e14e4e521b62565cac">memory_set_tracker</a> (<a class="el" href="structmemory__tracker__t.html">memory_tracker_t</a> tracker)</td></tr>
<tr class="memdesc:a9610bb0fee6903e14e4e521b62565cac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set current memory tracker.  <a href="#a9610bb0fee6903e14e4e521b62565cac">More...</a><br /></td></tr>
<tr class="separator:a9610bb0fee6903e14e4e521b62565cac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d0f12f2cc1cfcf1f971d796350b3e63"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> <a class="el" href="structmemory__system__t.html">memory_system_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a1d0f12f2cc1cfcf1f971d796350b3e63">memory_system_malloc</a> (void)</td></tr>
<tr class="memdesc:a1d0f12f2cc1cfcf1f971d796350b3e63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default malloc based memory system.  <a href="#a1d0f12f2cc1cfcf1f971d796350b3e63">More...</a><br /></td></tr>
<tr class="separator:a1d0f12f2cc1cfcf1f971d796350b3e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a280f5f81feaceee36745ddfc4d245194"><td class="memItemLeft" align="right" valign="top"><a class="el" href="platform_8h.html#ab5d798081ff1e38fc8d86a56b852da8e">FOUNDATION_API</a> <a class="el" href="structmemory__tracker__t.html">memory_tracker_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="memory_8h.html#a280f5f81feaceee36745ddfc4d245194">memory_tracker_local</a> (void)</td></tr>
<tr class="memdesc:a280f5f81feaceee36745ddfc4d245194"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default local memory tracker.  <a href="#a280f5f81feaceee36745ddfc4d245194">More...</a><br /></td></tr>
<tr class="separator:a280f5f81feaceee36745ddfc4d245194"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Memory allocation and deallocation. The actual implementation of allocation/deallocation can be controlled with the memory system declaration given to <a class="el" href="foundation_8h.html#ab04d33908f0c29d97de3fecd1e5881a0" title="Main entry point. ">foundation_initialize</a> at startup.</p>
<p>Memory allocation/deallocation can be tracked with memory_set_tracker if the build configuration <a class="el" href="build_8h.html#a999773b6eb8f1b6f3cf0663bbe5b6af2" title="Memory tracker control. ">BUILD_ENABLE_MEMORY_TRACKER</a> is set to 1. If not, all memory tracker calls are statically removed at compile time.</p>
<p>Memory can be tracked by context, set as a hash value (usually a static string hash) if the build configuration <a class="el" href="build_8h.html#a123163940bda0609bc624f38d38a9a4b" title="Memory context control. ">BUILD_ENABLE_MEMORY_CONTEXT</a> is set to 1. If not, all memory context calls are statically removed and context 0 is used everywhere. Memory contexts are stored per thread. </p>

<p>Definition in file <a class="el" href="memory_8h_source.html">memory.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ad20ff710fde100d7d59414d105456731"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_context_pop</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">void</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pop the current memory context off the context stack and set the new current memory context to the previous memory context (the one below on the context stack). If no previous memory context is available on the stack, the current memory context is set to 0. </p>

<p>Definition at line <a class="el" href="memory_8h_source.html#l00037">37</a> of file <a class="el" href="memory_8h_source.html">memory.h</a>.</p>

</div>
</div>
<a class="anchor" id="aca33749545ba97f1d9193fbe35d6bf80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t memory_context</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">void</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the current memory context, or 0 if no context is set </p><dl class="section return"><dt>Returns</dt><dd>Current memory context </dd></dl>

<p>Definition at line <a class="el" href="memory_8h_source.html#l00038">38</a> of file <a class="el" href="memory_8h_source.html">memory.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1fc5dd496c3d1ad2d6c0ba0e9a2dc8af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_context_thread_deallocate</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">void</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cleanup and deallocate any memory used for thread-local memory context data. Called internally when a foundation thread is about to exit. </p>

<p>Definition at line <a class="el" href="memory_8h_source.html#l00039">39</a> of file <a class="el" href="memory_8h_source.html">memory.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a533a4d5cb94f6bfe6c4289b2292e03dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * memory_allocate </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>align</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>hint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate memory. Memory will be aligned to the given alingment unless set to 0, which will cause alignment to be ignored. Memory hints can be given to allow the memory system to make better choises of how to allocate the memory (see <a class="el" href="types_8h.html#afff46e3dec0251d2d725ab4b7cacaa7e" title="Memory hints. ">memory_hint_t</a>). If context is 0, the currently set memory context scope is used (see <a class="el" href="memory_8h.html#aca33749545ba97f1d9193fbe35d6bf80" title="Get current memory context. ">memory_context</a>, <a class="el" href="memory_8h.html#acd065009f0b26996dad5f976bae8c241" title="Push context on memory context stack. ">memory_context_push</a> and <a class="el" href="memory_8h.html#ad20ff710fde100d7d59414d105456731" title="Pop context from memory context stack. ">memory_context_pop</a>) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>Memory context </td></tr>
    <tr><td class="paramname">size</td><td>Requested size </td></tr>
    <tr><td class="paramname">align</td><td>Requested alignment </td></tr>
    <tr><td class="paramname">hint</td><td>Hint flags </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Memory address to a memory block of the requested size and alignment, 0 if out of memory </dd></dl>

</div>
</div>
<a class="anchor" id="a2118a53e0722e8bcbfb2ed85437540fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * memory_reallocate </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>align</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>oldsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reallocate a memory block. Old memory content will be preserved, and if requested size is larger than the current size the new memory area above the old size will be uninitialized. The currently set memory context is used for any allocation. It is safe to pass null as the current memory block pointer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Current memory block pointer </td></tr>
    <tr><td class="paramname">size</td><td>New requested size </td></tr>
    <tr><td class="paramname">align</td><td>New requested alignment </td></tr>
    <tr><td class="paramname">oldsize</td><td>Previous size </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Memory address to a (potentially new) memory block of the requested size and alignment, 0 if out of memory </dd></dl>

</div>
</div>
<a class="anchor" id="a62d8f5df74f1f7e2e5ce2788d76c0ef7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_deallocate </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Deallocate a memory block. Safe to pass a null pointer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Memory block pointer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acd065009f0b26996dad5f976bae8c241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_context_push </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set a new current memory context by pushing it onto the context stack. A call to <a class="el" href="memory_8h.html#ad20ff710fde100d7d59414d105456731" title="Pop context from memory context stack. ">memory_context_pop</a> will restore the previous memory context. Memory context stack is thread-local, setting a new memory context will not affect the current memory context of any other thread. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>New memory context </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9610bb0fee6903e14e4e521b62565cac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_set_tracker </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmemory__tracker__t.html">memory_tracker_t</a>&#160;</td>
          <td class="paramname"><em>tracker</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the current memory tracker, see <a class="el" href="memory_8h.html#a280f5f81feaceee36745ddfc4d245194" title="Default local memory tracker. ">memory_tracker_local</a> for a default implementation </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tracker</td><td>New memory tracker declaration </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1d0f12f2cc1cfcf1f971d796350b3e63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmemory__system__t.html">memory_system_t</a> memory_system_malloc </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the default malloc based memory system declaration for passing to <a class="el" href="foundation_8h.html#ab04d33908f0c29d97de3fecd1e5881a0" title="Main entry point. ">foundation_initialize</a> </p><dl class="section return"><dt>Returns</dt><dd>Default malloc based memory system declation </dd></dl>

</div>
</div>
<a class="anchor" id="a280f5f81feaceee36745ddfc4d245194"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmemory__tracker__t.html">memory_tracker_t</a> memory_tracker_local </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the default local memory tracker declaration for passing to <a class="el" href="memory_8h.html#a9610bb0fee6903e14e4e521b62565cac" title="Set current memory tracker. ">memory_set_tracker</a> </p><dl class="section return"><dt>Returns</dt><dd>Default local memory tracker declaration </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
