<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Foundation Library: Building the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Foundation Library
   &#160;<span id="projectnumber">1.5.2</span>
   </div>
   <div id="projectbrief">Cross-platform application foundation library in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Overview</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Building the library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview">Overview</a><ul><li class="level2"><a href="#configs">Configurations</a><ul><li class="level3"><a href="#debug">Debug</a></li>
<li class="level3"><a href="#release">Release</a></li>
<li class="level3"><a href="#profile">Profile</a></li>
<li class="level3"><a href="#deploy">Deploy</a></li>
</ul>
</li>
<li class="level2"><a href="#output">Output</a></li>
</ul>
</li>
<li class="level1"><a href="#ninja">Ninja</a><ul><li class="level2"><a href="#ninja_configurations">Configurations</a></li>
<li class="level2"><a href="#ninja_arch">Architectures</a></li>
<li class="level2"><a href="#ninja_toolchain">Toolchains</a></li>
<li class="level2"><a href="#ninja_target">Targets</a></li>
<li class="level2"><a href="#ninja_host">Host specifics</a></li>
<li class="level2"><a href="#ninja_codesign">Code signing</a></li>
<li class="level2"><a href="#options">Build options</a></li>
</ul>
</li>
<li class="level1"><a href="#visual_studio">Visual Studio</a></li>
<li class="level1"><a href="#xcode">XCode</a></li>
<li class="level1"><a href="#external">External</a><ul><li class="level2"><a href="#flags_generic">Generic flags</a></li>
<li class="level2"><a href="#flags_clang">CLang flags</a></li>
<li class="level2"><a href="#flags_gcc">GCC flags</a></li>
<li class="level2"><a href="#flags_msc">MSC flags</a></li>
<li class="level2"><a href="#flags_intel">Intel flags</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="overview"></a>
Overview</h1>
<h2><a class="anchor" id="configs"></a>
Configurations</h2>
<p>The library can be built in four different build configurations with increasing amount of optimizations and decreasing amount of debug possibilities. The configurations are named debug, release, profile and deploy with the deploy configuration the recommended configuration for releases to the public.</p>
<h3><a class="anchor" id="debug"></a>
Debug</h3>
<p>In debug configuration no optimizations are enabled and all debug functionality is available in the library, including asserts, logging and error handling. This configuration is intented for development purposes.</p>
<h3><a class="anchor" id="release"></a>
Release</h3>
<p>In release configuration most optimizations are enabled and all debug functionality is available in the library, including asserts, logging and error handling. This configuration is intented for testing purposes.</p>
<h3><a class="anchor" id="profile"></a>
Profile</h3>
<p>In profile configuration all optimizations are enabled and all debug functionality is disabled in the library, including asserts, logging and error handling. Profiling hooks and measurements are included in the library code. This configuration is intented for profiling purposes, as it is identical to the final deploy build except for profiling code being enabled.</p>
<h3><a class="anchor" id="deploy"></a>
Deploy</h3>
<p>In deploy configuration all optimizations are enabled and all debug functionality is disabled in the library, including asserts, logging and error handling. Profiling is also disabled. This configuration is intented for public releases.</p>
<h2><a class="anchor" id="output"></a>
Output</h2>
<p>Libraries will be placed in lib/[platform]/[configuration]/[architecture] with platform names </p><ul>
<li>
windows </li>
<li>
linux </li>
<li>
macosx </li>
<li>
ios </li>
<li>
android </li>
<li>
bsd </li>
<li>
raspberrypi </li>
<li>
pnacl </li>
</ul>
<p>Configuration names are </p><ul>
<li>
debug </li>
<li>
release </li>
<li>
profile </li>
<li>
deploy </li>
</ul>
<p>Architecture names are </p><ul>
<li>
arm6 </li>
<li>
arm7 </li>
<li>
arm64 </li>
<li>
x86 </li>
<li>
x86-64 </li>
<li>
mips </li>
<li>
mips64 </li>
</ul>
<p>For MacOSX, iOS and PNaCl builds the libraries and binaries/apps will be universal and placed directly in the corresponding configuration directory and not in separate directories per architecture. For Android apps will be universal (containing the native variants used) and placed directly in the corresponding configuration directory.</p>
<p>Test cases are built as separate binaries with a launcher binary, placed in bin/[platform]/[configuration]/[architecture] (or directly in the configuration directory for MacOSX and iOS since the binaries are universal).</p>
<h1><a class="anchor" id="ninja"></a>
Ninja</h1>
<p>Building with Ninja is almost identical across all supported platforms. Use the build configuration python script in the root directory to set the architectures and build configurations you want, along with any configuration options.</p>
<h2><a class="anchor" id="ninja_configurations"></a>
Configurations</h2>
<p>Any combination of configurations can be built in one build. Specify which configurations to build with the -c switch. For example, to build all configurations use <code>-c debug -c release -c profile -c deploy</code>.</p>
<h2><a class="anchor" id="ninja_arch"></a>
Architectures</h2>
<p>Any combination of architectures supported by the host, target and toolchain combination can be built in one build. By default (if no other directive is given) all architectures supported will be built. Specify which architectures to build with the -a switch. For example, to build all architectures in an Android build use <code>-a arm6 -a arm7 -a arm64 -a mips -a mips64 -a x86 -a x86-64</code></p>
<h2><a class="anchor" id="ninja_toolchain"></a>
Toolchains</h2>
<p>There is currently support for four different toolchains depending on your host platform. These are GCC, CLang, Intel and Microsoft. Not all toolchains are supported on all host platforms. Specify which toolchain to use with the <code>&ndash;toolchain</code> switch. For example, to use gcc when building for Android use <code>&ndash;toolchain gcc</code>. The toolchain names are </p><ul>
<li>
gcc </li>
<li>
clang </li>
<li>
intel </li>
<li>
msvc </li>
</ul>
<h2><a class="anchor" id="ninja_target"></a>
Targets</h2>
<p>By using the target switch (-t) you can cross-compile to a secondary target platform. Currently you can cross compile for iOS on MacOS X, and for Android on Windows, Linux and MacOS X.</p>
<p>Use the <code>-t ios</code> target switch to specify iOS builds. By default arm7 and arm64 architectures will be built (universal).</p>
<p>Use the <code>-t android</code> target switch to specify Android builds. By default all architectures supported by your Android SDK/NDK will be built. For arm6 (armeabi) the library is built in ARM instruction mode (not THUMB). For arm7 (armeabi-v7a) the library is built in ARM instruction mode (not THUMB) and has NEON enabled.</p>
<h2><a class="anchor" id="ninja_host"></a>
Host specifics</h2>
<p>If you use SublimeText there is a template SublimeText project with a Ninja build tool setup in <code>build/foundation.sublime-project</code>. The build requires you to have generated a ninja build with the configure.py python script.</p>
<p>On Windows the default toolchain is the Microsoft compiler suite. You should run the appropriate <code>vcvarsall.bat</code> environment setup batch script for the architecture you choose prior to starting builds (or use the preconfigured command prompts from Visual Studio installs).</p>
<p>On MacOS X (and when cross compiling for iOS) the default toolchain is clang. The only supported architecture is x86-64 targetting MacOS X 10.7 or later, and arm7/arm64 targeting iOS 6.0 or later. The ninja will use the latest SDK and clang toolchain available by using the xcrun tool to locate SDK and binary paths.</p>
<p>On Linux the default toolchain is clang. The supported architectures are x86, x86-64, arm6, arm7, arm64, mips and mips64.</p>
<p>Building for Android requires NDK r11 or later. The default toolchain is clang.</p>
<p>On Raspberry Pi the default toolchain is gcc. The only supported architecture is arm6 (with Raspberry Pi specific compiler switches).</p>
<h2><a class="anchor" id="ninja_codesign"></a>
Code signing</h2>
<p>The Ninja build will by default sign the Android apk and iOS app bundles it builds. The signatures, keystores and passwords used in this process can be specified through the build options. On Android the default settings is to use the normal Android SDK debug keystore to autosign the apk.</p>
<h2><a class="anchor" id="options"></a>
Build options</h2>
<p>Some build variables can be set externally from the ninja build files. These variables are </p><ul>
<li>
android: ndkpath - Path to the Android NDK (no default) </li>
<li>
android: sdkpath - Path to the Android SDK (no default) </li>
<li>
android: keystore - Keystore to use when signing APK (default "~/.android/debug.keystore") </li>
<li>
android: keyalias = Key alias to use when signing API (default "androiddebugkey") </li>
<li>
android: keystorepass - Password for keystore used when signing APK (default "android") </li>
<li>
android: keypass - Password for key used when signing APK (default "android") </li>
<li>
android: platformversion - Android platform version to use when building (default "21") </li>
<li>
android: gccversion - GCC toolchain version to use when building (default "4.9") </li>
<li>
android: tsa - Location of the Timestamping Authority </li>
<li>
android: tsacert - Public key certificate for Timestamping Authority </li>
<li>
ios: deploymenttarget - Minimum iOS target version (default "6.0") </li>
<li>
ios: organisation - Organisation identifier on format "TXYZAB01CD" (no default) </li>
<li>
ios: bundleidentifier - Bundle identifier on format "com.company.id" (no default) </li>
<li>
ios: signature - Certificate signature (no default) </li>
<li>
ios: provisioning - Mobile provisioning profile path (no default) </li>
<li>
macosx: deploymenttarget - Minimum MacOS X target version (default "10.7") </li>
<li>
macosx: organisation - Organisation identifier on format "TXYZAB01CD" (no default) </li>
<li>
macosx: bundleidentifier - Bundle identifier on format "com.company.id" (no default) </li>
<li>
msvc: toolchain - Path to Visual Studio toolchain to use (default value is autodetected) </li>
<li>
msvc: sdkpath - Path to Windows SDK to use (default value is autodetected) </li>
<li>
pnacl: sdkpath - Path to the PNaCl SDK (no default) </li>
<li>
tizen: sdkpath - Path to the Tizen SDK (no default) </li>
<li>
tizen: platformversion - Version of the Tizen platform to use (default "2.3") </li>
<li>
tizen: gccversion - GCC toolchain version to use when building (default "4.8") </li>
<li>
tizen: clangversion - CLang toolchain version to use when building (default "3.4") </li>
</ul>
<p>The bundle identifier variables can contain expansion variables which will be substituted during build. These include </p><ul>
<li>
$(binname) - Binary name (for example, "test-all") </li>
</ul>
<p>The variables can be set in four different ways, in increasing order of priority. </p><ul>
<li>
configure.py script variables passed to generator </li>
<li>
build.json file in root project directory, read during configure.py execution </li>
<li>
codesign.json file in root project directory, read at build time </li>
</ul>
<p>Passing variables to the generator in configure.py is a simple list of key-value pairs. For example <code>variables = [ ( 'bundleidentifier', 'com.rampantpixels.foundation.$(binname)' ) ]</code>. Any variables that have a identical name with different platform prefix can be passed without any platform name as in the example. The value will be applied to all platform specific variables.</p>
<p>The build.json is a simple host-local file which can hold any variable values listed. The value should be put in enclosing groups for each platforms (see example). The values will be set after parsing the configure.py variables. An example build.json file: </p><pre>{
    "android" : {
        "ndkpath" : "~/android-ndk",
        "sdkpath" : "~/android-sdk",
        "platformversion" : "21",
        "gccversion" : "4.9",
    },
    "ios" : {
        "deploymenttarget" : "6.0"
    },
    "macosx" : {
        "deploymenttarget" : "10.7"
    }
    "msvc" : {
        "toolchain" : "C:/Program Files (x86)/Microsoft Visual Studio 12.0/VC/bin"
    }
}</pre><p>Finally, the codesign.json is read by the codesigning phase at build time and can hold the secrets related to code signing. This allows you to have the secret locally on the build machine without requiring recreation of the build scripts or storing secrets in version control. The format is the same as for build.json and the variables used are: </p><ul>
<li>
android: keystore </li>
<li>
android: keyalias </li>
<li>
android: keystorepass </li>
<li>
android: keypass </li>
<li>
android: tsa </li>
<li>
android: tsacert </li>
<li>
ios: organisation </li>
<li>
ios: bundleidentifier </li>
<li>
ios: signature </li>
<li>
ios: provisioning </li>
<li>
macosx: organisation </li>
<li>
macosx: bundleidentifier </li>
<li>
macosx: signature </li>
</ul>
<p>An example codesign.json file: </p><pre>{
    "android" : {
        "keystore" : "~/.android/debug.keystore",
        "keyalias" : "androiddebugkey",
        "keystorepass" : "android",
        "keypass" : "android"
    },
    "ios" : {
        "organisation" : "TXXXYZ12AB",
        "bundleidentifier" : "com.mycompany.\$(binname)",
        "signature" : "ABCDEF0123456789ABCDEF0123456789ABCDEF01",
        "provisioning" : "01234567-89AB-CDEF-0123-456789ABCDEF.mobileprovision"
    },
    "macosx" : {
        "organisation" : "TXXXYZ12AB",
        "bundleidentifier" : "com.mycompany.$(binname)",
        "signature" : "ABCDEF0123456789ABCDEF0123456789ABCDEF01"
    }
}</pre><h1><a class="anchor" id="visual_studio"></a>
Visual Studio</h1>
<p>On Windows we currently support building with Microsoft and Intel compilers with Visual Studio 2015. Both 32-bit and 64-bit Windows are supported. To build with Visual Studio, open the foundation.sln solution file Visual Studio 2015 in <code>build/vs15</code>. To build all targets and configurations use batch build, select all targets and build.</p>
<h1><a class="anchor" id="xcode"></a>
XCode</h1>
<p>To build with XCode, open the XCode workspace in <code>build/xcode/foundation-osx.xcworkspace</code> for MacOS X and <code>build/xcode/foundation-ios.xcworkspace</code> for iOS and build the appropriate targets. The workspace contains projects for both foundation library and test cases. The only supported architecture is x86-64 targetting MacOS X 10.7 or later, or for iOS arm7/arm64 targeting iOS 6.0 or later.</p>
<h1><a class="anchor" id="external"></a>
External</h1>
<p>For integration with other build systems, here is a list of the compiler/linker flags used during compilation and linking of the foundation library, test apps and tools.</p>
<h2><a class="anchor" id="flags_generic"></a>
Generic flags</h2>
<p>During compilation of the library itself, <code>FOUNDATION_COMPILE</code> should be defined to non-zero. This must not be defined when compiling projects that use the library.</p>
<p>Depending on the build configuration wanted, the appropriate build configuration symbol should be defined to non-zero. </p><ul>
<li>
<code>BUILD_DEBUG</code> </li>
<li>
<code>BUILD_RELEASE</code> </li>
<li>
<code>BUILD_PROFILE</code> </li>
<li>
<code>BUILD_DEPLOY</code> </li>
</ul>
<p>All other build control directives are defined in the <a class="el" href="build_8h.html" title="Build setup. ">build.h</a> header.</p>
<h2><a class="anchor" id="flags_clang"></a>
CLang flags</h2>
<ul>
<li>Include/build: <code>-I. -Itest -DFOUNDATION_COMPILE=1 -DBUILD_&lt;DEBUG|RELEASE|PROFILE|DEPLOY&gt;=1</code></li>
<li>Warning: <code>-W -Weverything -Werror</code></li>
<li>All builds: <code>-funit-at-a-time -fstrict-aliasing -fno-math-errno -ffinite-math-only -funsafe-math-optimizations -fno-trapping-math -ffast-math -g</code></li>
<li>Debug: <code>-O0</code></li>
<li>Release: <code>-funroll-loops -O3</code></li>
<li>Profile/deploy: <code>-funroll-loops -O3</code></li>
</ul>
<p>All platforms use <code>-std=c11</code> to define using the C11 standard.</p>
<h2><a class="anchor" id="flags_gcc"></a>
GCC flags</h2>
<ul>
<li>Include/build: <code>-I. -Itest -DFOUNDATION_COMPILE=1 -DBUILD_&lt;DEBUG|RELEASE|PROFILE|DEPLOY&gt;=1</code></li>
<li>Warning: <code>-W -Wall -Werror</code></li>
<li>All builds: <code>-funit-at-a-time -fstrict-aliasing -fno-math-errno -ffinite-math-only -funsafe-math-optimizations -fno-trapping-math -ffast-math -g</code></li>
<li>Debug: <code>-O0</code></li>
<li>Release: <code>-funroll-loops -O3</code></li>
<li>Profile/deploy: <code>-funroll-loops -O4</code></li>
</ul>
<p>Most platforms use <code>-std=c11</code> to define using the C11 standard. The exceptions for this is Android which uses <code>-std=gnu11</code> to work around issues in the NDK includes, and Raspberry Pi which uses <code>-std=c99</code> due to lack of compiler support at the time. Raspberry Pi builds also use <code>-fno-omit-frame-pointer</code> to make the stack walker work using frame pointers.</p>
<p>Apart from this you should specify the appropriate machine flags for the architecture you are compiling for, like <code>-m64</code> for x86-64.</p>
<h2><a class="anchor" id="flags_msc"></a>
MSC flags</h2>
<ul>
<li>All builds: <code>/DFOUNDATION_COMPILE=1 /DBUILD_&lt;DEBUG|RELEASE|PROFILE|DEPLOY&gt;=1 /Zi /W3 /WX /Oi /Oy- /MT /GS- /Gy- /GF- /Gm- /Qpar- /fp:fast /fp:except- /Zc:forScope /Zc:wchar_t /GR- /openmp-</code></li>
<li>Debug: <code>/Od</code></li>
<li>Release: <code>/Od</code></li>
<li>Profile: <code>/O2 /Ob2 /Ot /GT /GL</code></li>
<li>Deploy: <code>/Ox /Ob2 /Ot /GT /GL</code></li>
</ul>
<p>For x86 targets <code>/arch:SSE2</code> is used in all builds.</p>
<p>For x86-64 targets no additional flags are used.</p>
<h2><a class="anchor" id="flags_intel"></a>
Intel flags</h2>
<p>To be written... </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
